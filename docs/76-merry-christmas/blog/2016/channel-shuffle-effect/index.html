<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.2.0">
<title data-rh="true">Channel Shuffle Effect | PCSX2</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://pcsx2.net/img/logo.png"><meta data-rh="true" name="twitter:image" content="https://pcsx2.net/img/logo.png"><meta data-rh="true" property="og:url" content="https://pcsx2.net/blog/2016/channel-shuffle-effect"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Channel Shuffle Effect | PCSX2"><meta data-rh="true" name="description" content="GSdx got various improvements recently, issues were fixed on games such as Metal Gear Solid 3, Gran Turismo 4, Tekken 5, Tales of Legendia and Urban Chaos. All of those games use a certain effect that I have nicknamed as the Channel Shuffle Effect"><meta data-rh="true" property="og:description" content="GSdx got various improvements recently, issues were fixed on games such as Metal Gear Solid 3, Gran Turismo 4, Tekken 5, Tales of Legendia and Urban Chaos. All of those games use a certain effect that I have nicknamed as the Channel Shuffle Effect"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2016-08-03T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://github.com/gregory38"><meta data-rh="true" property="article:tag" content="devblog"><link data-rh="true" rel="icon" href="/img/favicon.webp"><link data-rh="true" rel="canonical" href="https://pcsx2.net/blog/2016/channel-shuffle-effect"><link data-rh="true" rel="alternate" href="https://pcsx2.net/blog/2016/channel-shuffle-effect" hreflang="en"><link data-rh="true" rel="alternate" href="https://pcsx2.net/blog/2016/channel-shuffle-effect" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="PCSX2 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="PCSX2 Atom Feed">
<link rel="alternate" type="application/json" href="/blog/feed.json" title="PCSX2 JSON Feed">





<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Roboto+Mono:wght@400;700&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons"><link rel="stylesheet" href="/assets/css/styles.8125b5be.css">
<link rel="preload" href="/assets/js/runtime~main.29d2e02b.js" as="script">
<link rel="preload" href="/assets/js/main.ce2c7a2d.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function e(e){document.documentElement.setAttribute("data-theme",e)}var t=function(){var e=null;try{e=localStorage.getItem("theme")}catch(e){}return e}();null!==t?e(t):window.matchMedia("(prefers-color-scheme: dark)").matches?e("dark"):window.matchMedia("(prefers-color-scheme: light)").matches?e("light"):e("dark")}()</script><div id="__docusaurus">
<div data-overlay-container="true"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.webp" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.webp" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">PCSX2</b></a><a class="navbar__item navbar__link" href="/downloads">Download</a><a class="navbar__item navbar__link" href="/compat">Compatibility</a><a class="navbar__item navbar__link" href="/docs/">Documentation</a><div class="navbar__item dropdown dropdown--hoverable"><a aria-current="page" class="navbar__link active" aria-haspopup="true" aria-expanded="false" role="button" href="/blog">Blog</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/blog/tags/progress-report">Progress Reports</a></li><li><a class="dropdown__link" href="/blog/tags/devblog">Developer Blogs</a></li></ul></div></div><div class="navbar__items navbar__items--right"><a class="nextui-c-iWjDFM nextui-c-PJLV nextui-c-iWjDFM-hkKLfu-color-default nextui-c-iWjDFM-gkIlwi-size-md nextui-c-iWjDFM-cwXrJp-borderWeight-normal nextui-c-iWjDFM-exaRme-auto-true nextui-c-iWjDFM-gglxka-cv nextui-c-PJLV-gulvcB-isFocusVisible-false nextui-c-iWjDFM-iiPoHku-css nextui-button nextui-button--ready" data-state="ready" role="button" tabindex="0" href="https://github.com/sponsors/PCSX2" target="_blank" type="button" rel="noreferrer"><span class="nextui-c-bDGMeb nextui-c-bDGMeb-jzMUFa-isAuto-true nextui-c-bDGMeb-hjqCeZ-cv nextui-c-bDGMeb-iPJLV-css nextui-button-icon"><svg stroke="currentColor" fill="var(--nextui-colors-red600)" stroke-width="0" viewBox="0 0 12 16" height="20" width="20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M9 2c-.97 0-1.69.42-2.2 1-.51.58-.78.92-.8 1-.02-.08-.28-.42-.8-1-.52-.58-1.17-1-2.2-1-1.632.086-2.954 1.333-3 3 0 .52.09 1.52.67 2.67C1.25 8.82 3.01 10.61 6 13c2.98-2.39 4.77-4.17 5.34-5.33C11.91 6.51 12 5.5 12 5c-.047-1.69-1.342-2.913-3-3z"></path></svg></span><div class="nextui-button-text nextui-button-text-left">Donate</div></a><a href="https://forums.pcsx2.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Forums</a><a href="https://wiki.pcsx2.net/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Wiki</a><a href="https://discord.com/invite/TCz3t9k" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-discord-link" aria-label="PCSX2 Discord Server"></a><a href="https://github.com/PCSX2/pcsx2" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="PCSX2 GitHub repository"></a><a href="https://twitter.com/PCSX2" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-twitter-link" aria-label="PCSX2 Twitter"></a><a href="https://www.youtube.com/user/PCSX2team" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-youtube-link" aria-label="PCSX2 YouTube channel"></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently dark mode)" aria-label="Switch between dark and light mode (currently dark mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><main class="col col--9 col--offset-1" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">Channel Shuffle Effect</h1><div class="container_mt6G margin-vert--md"><time datetime="2016-08-03T00:00:00.000Z" itemprop="datePublished">August 3, 2016</time> Â· <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/gregory38" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/gregory38.png" alt="Gregory"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/gregory38" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Gregory</span></a></div></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><h1>Introduction</h1><p>Dear PCSX2 users,</p><p>GSdx got various improvements recently, issues were fixed on games such
as Metal Gear Solid 3, Gran Turismo 4, Tekken 5, Tales of Legendia and
Urban Chaos. All of those games use a certain effect that I have
nicknamed as the <strong>&quot;Channel Shuffle Effect&quot;</strong>. All games use a variation of this effect but each time
the effect proved to be memory expensive and it was very slow, even with
the best computers. The effect is very interesting because it explains
the rendering/GPU architecture evolution from a fixed unit to a
processor. So I decided to take this opportunity to explain it the best
I can.</p><h1>II) GPU evolution/revolution : Fixed Unit vs Shader Unit</h1><p>So let&#x27;s start with a bit of history. A long time ago, nearly 20 years
ago! (yeah the PS2 isn&#x27;t in its prime youth), GPUs were hardwired to
execute fixed rendering tasks. Back then, they were called &#x27;acceleration
units&#x27;. Hardwired renderers give you speed, power efficiency, but it is
costly (silicon wise) and, well, they are hardwired to do a specific
task. It was fine at the start, but then game designers wanted more and
more effects. A new effect would have required a new GPU with a new
fixed function unit. It was kind of feasible on the PC market but not in
the console market where a new GPU is released only every 5 years. So
game designers tricked the fixed function unit to emulate some new
effects (such as gamma correction, depth of field, ...). The hardware
was fast, but the emulation of such effects required more work than the
real rendering of the image. Overhead was quite enormous. Accelerated
hardware was dead. Welcome the new king, Shaders.</p><p>So what is a Shader unit? It is basically a small processor that
executes software code designed specifically for them. The issue is that
processors are slow, utterly slow, however they are cheap (silicon
wise). However a processor could execute any effect you want. So in
order to compensate for the slowness of those processors, thousands of
them are put in parallel. Hence complex effects can be done essentially
for free.</p><p>Now you probably understand the difference between a fixed unit and a
shader unit. Let&#x27;s get back to the GS emulation.</p><h1>III) The GS case</h1><p>GS is a pure fixed unit. You can basically configure the texture format,
the framebuffer format and the final blending equation. Note, the
blending equation is quite basic too.</p><p>You can configure the GS to do 2 main color operations,</p><ul><li>primitive color <!-- -->*<!-- --> texture color</li><li>primitive color (when no texture is available)</li></ul><p>Texture sampling operations are done on the 4
channels(Green/Red/Blue/Alpha) at once. You can&#x27;t select any one of
them. It is all or nothing.</p><p>But how does a game like Gran Turismo 4 manage to apply a
brightness/contrast effect? How can a game apply a depth effect based on
the upper 6 bits of the 16 bits depth buffer? It&#x27;s crazy, game designers
were high ! Yes, you guess it right, they abused magic mushrooms!</p><h1>IV) First example: Gran Turismo 4 rendering</h1><p>Fasten your seat belt and let&#x27;s dive into the Gran Turismo 4 rendering
engine and look at the brightness effect.</p><p>The engine uses 2 textures as input. The image that will get the
brightness correction applied and a palette. The palette is basically a
lookup table or an array of colors. It allows to transform an index into
a new color. Basically the game will save the brightness correction
function in the palette. So color 10 will be transformed to 15.</p><p>Here&#x27;s the palette that will do the brightness correction:</p><p><img loading="lazy" src="data:image/webp;base64,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" width="2396" height="41" class="img_ev3q"></p><p>Here is an HLE (High Level Emulation) shader implementation.</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">vec4 rt        </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">sample_input_texture</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">output_color</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">r </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">sample_palette</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">r</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">r</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">output_color</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">g </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">sample_palette</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">g</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">g</span><span class="token punctuation" style="color:#f8f8f2">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#f8f8f2"><span class="token plain">output_color</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">b </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">sample_palette</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">b</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">b</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is only a few lines of shader code. First line will read the current
texture color. The 2nd line will apply the brightness correction on the
red channel. The 3rd will do the same for the green, and the 4th for the
blue. It can all be done with a single draw call and it is very fast
even on a slow computer. Last but not least it took 3 minutes to
implement it.</p><p>But I have cheated, this isn&#x27;t the GS way, it is the effect that would
have been implemented on a standard GPU. The GS method is quite
harder.</p><p>First of all, in order to improve the memory access performance on the
GS, the framebuffer will be split into many (150) tiny framebuffers of
64x32 pixels. Actually it is the size of a GS memory page. Of course
GSdx doesn&#x27;t like this as it needs to allocate a 1280x1024 pixel
framebuffer for every one of those tiny 64x32 pixel framebuffers, this
lead to VRAM spikes at certain scenarios.</p><p>Eventually the brightness effect will be applied on each framebuffers.
So yes it is executed 150 times. It requires around 10 GS equivalent
draw calls though due to emulation overhead it would be around 15 GPU
draw calls. Let&#x27;s put some numbers in perspective:</p><p>*<!-- -->A good limit for GPU game is <!-- -->~<!-- -->1000 draw call</p><p>*<!-- -->Gran Turismo 4 frame is 2250 GS draw calls so likely between 2500-3000
draw calls! Ouch.</p><p>*<!-- -->The Gran Turismo 4 brightness effect costs 1500 GS draw calls, it is
huge! 66% of the frame rendering is only a single effect. In others
words, removing the effect would make the GS emulation nearly 3 time
faster.</p><p>Now let&#x27;s decompose the effect. The equivalent of</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#f8f8f2;--prism-background-color:#272822"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#f8f8f2"><span class="token plain">c</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">r </span><span class="token operator" style="color:#66d9ef">=</span><span class="token plain"> </span><span class="token function" style="color:#e6db74">sample_palette</span><span class="token punctuation" style="color:#f8f8f2">(</span><span class="token plain">rt</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">r</span><span class="token punctuation" style="color:#f8f8f2">)</span><span class="token punctuation" style="color:#f8f8f2">.</span><span class="token plain">r</span><span class="token punctuation" style="color:#f8f8f2">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It is executed 3 times, one for each channel (Red/Green/Blue). The above
explanation is done for a framebuffer of 64x32, you need to repeat it
enough times to cover the full screen. It is already costly on
performance to do it once but it should be executed 150 times !</p><p>So the effect is based on a single trick, write the image into a RGBA8
color of size 64x32 but read it back as a 8 bits integer index of the
palette. A 32 bits colors contains four 8 bits channel. So for the gs,
the image is now 128x64. Of course you can&#x27;t magically change the size
of a texture in a modern GPU neither the format. So you need to convert
it. And guess what? it is quite expensive.</p><p>Here&#x27;s the picture of the initial format (aka human format) and then the
GS format:</p><p><img loading="lazy" src="data:image/webp;base64,UklGRsgFAABXRUJQVlA4ILwFAABwNgCdASphAdQAPm02lkgkLyKjpTyZWeANiWlu3rpOO88DOV1M/T+4Qba8m3mkyD6MCkOs6LguIN7br6QIhF7iX5RCoiSgE8RwJzoM2RQp0O9MrO2EFso5EALH1p67OKnSMDNcmS05QI42eeEFS4Lq5M1L/jy4FjBdD4tAWKb0x8sp5UIcKEaIvMGCVjM89TGEpO8Jn5h3BiJiCow+CFMFe21ZD5gSmEElY3oVXY5B+tjIDwUyTsNiXqelbIORMzL2b3G/+6AEET0T7yC85IHU1ZeC3V8ZI7ymj+nk+BAwV7pEdb9JwrNdZpUjm7UNBxJaXX9pYhYsM/Mdb+rskck1jzUdiHzVb9ik686pBCafuFje5VFCSVSJqHJOp+rA4Oz4Vwx/gYjcRrWvCD78pvvBmqVf8oZ1TkxRU6xyQiZHbOgPNTmvJPypN+IRHaRUuaROvOqQQm/HzLIfUUwnElDxw7IuUKIKrb53l5abzXXfd40jcjvy0sQ/gnUvF7d3nuQx/X3B1DmAu6i26uYfAsi2N0UwBOoDDmHncvrcCj0IYvVYvma3igRTTdlriNRy5cFjhT/KuNSE/X1MAgAA/ox0Cr3Je04npnOZ/bUZrucmYc7wYkyxte8KLxg7ZozlmnHhEwJntrFI/SWt9I+EL2Cztd+fBwRUmi0ZCxWoLCAF2RbMNlV76CWnHhEwJn+VsiFZunLmcvvZDZzLHIGqKwpnXLrsEJm4wO5w2DYRstRQRScct2RKDf4cXP2j4C4JWo/BnrgoPncOLyNAdKg6lenLKeqMh9/QaeAFlpiLxrN9nOfiSFEykZ0Hc75nNYk0p37mi+pFbyu3jMa5kcOHR9QKzf8wWvLFPIj3JvjyBL/o/ZXNTPTeixn7ZPPBYmh7b3NXGBjt36mK2kvAVm6cZ2eEkf2oOtB8B1shLW2lfUtMXJ5E8QNNbgdRLmdP/50mLsX42Hel91ChYpp+oWKOXsTa61weMgRzR2Gbo9fdlcxS1kNMqf14hxmuZ0//nSbCZGEAOffCjUNP/YJSWgM+lMtGzUXTCKJi3f6qyu+hWKmGT9dEr9QIrVPgmBOTKlCPMCRqCiV8iGvRoEBiN9eB+oDwGNRQU7iAwS6g2vUH++0DZbvbxsPfxbHZzBY1fZqSyGk/1n9XQaF4EP2a+rK1hxJQYSou3rrjkLBcee73yAo1DiX+9CF6WD4c21zAZ42yIqug7j2aF8sIprIiorcaHjuciE/qBuN/T55+d7lvSQjLuWR4eYdaCzi9KyJko9qwWpQtMW7lEmOR6E+Xg/SdUmoG2fwQ7W/oXA0RGzX5Mt2Em/b4iJWsjk8GQmC0IVYZLQAB1HMJVvfOuIpsc/hQkncdNU45yfYytSBpCyroCcL5J5UzkcUi5tqRnFUG4vuy+vBqrw730d2p2GLfrN/bINcsCthwXoVfFNbS+NYi2P35yuu+GguMFgW8nVUqiNAXwYq8JuFoDHnhyfLTKQYpFwJsLO9JeUQbJyWNa79I/fQOqxr0A+1l07eK5aB/sHHDk7ArjIkijpkIvAGNGhWTAcLasPQmbZ/fpOQNDlRMI2nv5iq2OURqv+94L87IAlHPQpsf1DZ5o96bKlGziW3bz7iZHdTLOnWX0dpysn5CV+SpqQlorRx9771+Llnh9nZ2g4ILDkqpmKgzESXKAMhiKUldmA/09ZKvI0KNLHMOi0kMnHKRZ1LnqgL/qm2Fongzqcr7NXj+YxNmq/oz2O8tw+gbYCsePirI2p+765S+GD9aJY6BZWWD47VuuZY+V9YMuPA56Rkm42WMdF/R0EOJwMGr4nLd0+u9J/QXdTLRRvGB3oOhz4ev4WpQ+D/B679I4GRqzluyeiBJryZmHhmdSvgKj8QTZItG2/y1Rb9/8MO1RGNiku86XaZUT6mvlAkcQZAurcEfFmX63L4PULge32LFCy8+Li1wQQxgAAAA" width="353" height="212" class="img_ev3q">
<img loading="lazy" src="/assets/images/gt4_before_effect_8bit_s-4a842597c9e47737071b0873500a13f5.webp" width="353" height="182" class="img_ev3q"></p><p>Yes it is nice but it is even more complex than you think. Granted, it
isn&#x27;t easy to see it but the texels aren&#x27;t in the same order. You can
infer some small rectangle (8x2 texels), they contain a single channel
of the initial color.</p><p>Will anybody find the original image part (full image can be seen
below)?</p><p><img loading="lazy" src="data:image/webp;base64,UklGRnoFAABXRUJQVlA4IG4FAABwGgCdASqAAEAAPm02lkkkIyIhJBQIkIANiWlpO/hf+3m//10PNv+Z/fvy7nf/0/s/67//d9cmf+ICOAQAD+u/hL+lYNC93f/VPC/yX+f8u/J/0A6kH6n70/ivUX+r/43+a+IPqA/Enz4fkvmq+l3gn3H/i5eEIea/dv+7/pfyU93nz16LHVa/Zf2Gv2OR6imyZl8IvdEgWVrvpjwcCcpQC5Bp77xwZd/UhB7FF9rT9jgySJdO4Sb8UTss8Mlnyb6tli7fZXzyFZFB9sJ5DHpfCeZdC+/bHWS4R4qAAP1v+O2NQaxKzDOU5kGH2o7YKrbukNtSJFjOmjL9HFM7NSuZh6JfOy34Y0Vrw9Ra9naaoaf3TJaL4z3HiovcOdw2qzpN9ofnlbBP0945xZCPornokh1Xb6/h3pEfaUu+5eHu92P3xUrjO38lQLXSPv+B8RFRgDJsc6zYYb48tm8ohqZSK0yUVDelBjhCzUAeox3qj/xVAnCrkTrdg4/VjdIUPnuWKoaH0se2lU5PEU8ETEKnh992OpZmiXuJf1HehTVnYKcf0OfW9SYd75pg5h6XDgXo2nsYAGb+tWuon6pJkCwDEWr4K5nuy9rvAN0Gu7uFzrYBPu2vAhwbggjXGioVJrxUdF+iyap/noDaZerbW+4xaSFQ1mZK1gsO+Wao/pz4mMhbBCoiJFEpzWZXmLE2tsJMqSDA5C9ZJmbOXzrmiplUrh7Zg/eDXaCbKp4/H5eSFR2jyxhQ/mENb3GxuQwDkOcmEP7hkACgQdvWjOrdaU9idSnhJoN9cF49KCF5vBvgSJWP2nanpt0fCk0CNm1r5qrTnZAhLNNXgGWrq7fqhJvYpzjt0nb38SLr1oxO2GrnrwQ+VftEAxA6rAiQ8GDg3wJaHyy+yOFTRLIcYqePMrnm8WgK5S7+Sqiq7JMAdmoCu6AdrM2KZH+qHZMXDGTWCa9gYmrdSBxdSO5o6rwawMcpamcwI5VNYLdA89VzPNGyriUXkc/976qUzlo+26ogEFSwe4iaLtKKoUmXQJj9GaBbnGvI0HJZqaINCICzWdr+SUHMUSxoMtLkq36G/8mv2NfmDJ6OsX4zTwBZ7GNFDYvhU9AkDanCzN4nV6Z6zJ6TBI1A6WxIbIcMpnkHgSj0pTQ47/KalHFT0noOW+2Ywh8RnbPOf2+75ezaSPh9RSe70RfQm7b7BQtaKMykKOa19ZmYRtBQL9oX9rbe47C6TNJO5niS5Z3dkMzJAFBjH4FBEJdNZG3zkAGWfejOkPQlaH965qa6foanRhTYiIcQJ7d39zMhEKI/VKV0u3rvLq3FStdJxMy/V07bdvRdPgZ4xBitSiG7Zv1T+EsBAP0PCvrHemIHIFk2R1wEJ0uic4ZhULLEBMxhDDIbJ6N2w9CNVp+/LdS5JGXpBw4AQb62L9FdjS58xho5S4qu4nCNVNNbCUMYQUeAxiGh88dOfggB/GqN/U4KoVGOu7sPC71b1HbH7xbsssQN1h66Y1LoTeRTQsFbI2T+2bcCFxwZmGR2JHhhJJ91871qPBvZenOpT+xLeiXpgMNkdRLTKUxle6lKaLQ7Z1YcOcKrwzNuPWtxY4JtcBTzJrLV2Wbc6VTJkXDDzySUEpu487IV4x/D41AfDLKR3WWtG3c4EYY2f6EiwDW41xWALSvmd5x6n5qGnuAFSaLoN/jP5JotNekYrSuTikzJNbgprPngXuhxFp1/giVUh1ou1/UYFN5oDVPpwcFJW+reTrgITsHs4vLHL/3skIvqS2PtFWlUDIdztOrReKEqPUWvmS6U3ZPC8M3844ZnbUT/LKdnld1+ODzjLVfDMrb3UBi7pHFHZfCHHVAA" width="128" height="64" class="img_ev3q"></p><p>You could imagine the complexity to debug the effect.</p><p>As I said in the beginning the basic operation of the GS is &quot;primitive
color <!-- -->*<!-- --> texture color&quot;. We only want to write the red channel so
primitive color will be (1.0f, 0.0f, 0.0f, 0.0f) i.e. red will be one
and the other channels will be 0. So GS output is basically the red
channel of the texture color. Now the texture color case is left, of
course you can&#x27;t just render a single sprite. You only want to sample
the 8 bits index that used to be the red channel of the frame. The value
will be converted by the palette. And you&#x27;re done</p><p>No I&#x27;m kidding, we&#x27;ve just started.</p><p>So Gran Turismo 4 will render 16 sprites to cherry pick the correct
index and try to put it back mostly in the correct order. Why mostly in
order? Because the game uses an extra optimization here, if you want to
fully descramble the texels, it would likely requires too many sprites
rendering, something around 256 sprites. So rendering will be done
scrambled for all channels.</p><p>They could have send a kaleidoscope in the game package but finally they
decided it was nicer to unscramble the texels. Again, a new trick</p><p>Yes we love tricks</p><p>The framebuffer will read back as a 256x1 palette. Wait you said that
framebuffer was 64x32! Yes it would be read back 8 times as 8 palettes.
And the input texture is really special, you can see it below. The
texture contains the position of the future pixels and you guessed it
right, it would unscramble the mess. It is efficient (well efficient for
the GS) because you can unscramble your pixels with only 8 extra
sprites. And that&#x27;s it.</p><p>Here&#x27;s the special texture to unscramble data:</p><p><img loading="lazy" src="data:image/webp;base64,UklGRnIAAABXRUJQVlA4IGYAAAAQBQCdASoIACAALk02m02hJCQkBABMS1AE6ZQjubyWmA//+4ABfT4hhAFud1a32pzQAP7/HPrg29rIEWha+4uSZfFbpd4PRz1e59OztOKXZwpnQGKXyb4crUtvzig3XxUB+CVAAAA=" width="8" height="32" class="img_ev3q"></p><p>Plus some screenshots of the effect (before/after)</p><p><img loading="lazy" src="data:image/webp;base64,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" width="353" height="247" class="img_ev3q">
<img loading="lazy" src="data:image/webp;base64,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" width="353" height="247" class="img_ev3q"></p><h1>V) Second example: Urban Chaos rendering</h1><p>The new trending effect when the PS2 was released was the depth of field
effect. Basically, it&#x27;s an effect that depends on the depth. A basic
example will be a darker/blurrier object if it&#x27;s far away. It&#x27;s rather
basic to implement, you just need to modulate the color based on the
depth value. Unfortunately you can&#x27;t read the depth value like that. So
let&#x27;s see what the game does.</p><p>Urban Chaos uses a 16 bits integer depth format. Actually the game
limits the rendering to 11 bits. So the depth ranges from 0 to 2047. The
game creators decided that the top 8 bits will be enough to implement
the depth modulation. But a single issue remains, how to extract those 8
bits! Again it will apply on a small framebuffer, and it will consume
tons of draw calls, tons of memory.</p><p>At a higher level, it&#x27;s very close to Gran Turismo. Close, but not the
same. Good news, it&#x27;s easier than Gran Turismo as you don&#x27;t want an
accurate depth information so you don&#x27;t need to bother with shuffle
pixels. So we have seen a way to read back a single channel of a
framebuffer and how to apply a correction factor. Urban Chaos will do
the same but on the depth texture.</p><p>Here&#x27;s a small drawing to explain the now easy process:</p><p><img loading="lazy" src="/assets/images/urban_chaos_s-2269a5ff17890697f9146b6bb703b3d1.webp" width="560" height="412" class="img_ev3q"></p><p>At the top of the drawing, you have the 16 bits depth. The GS will read
it as a color texture (aka RGB5A1) so I set some nice colors for the
red, green and blue channels. The depth is split into two 8 bits
channels, be aware it doesn&#x27;t map with the color channel because the
effect works on 32 bits memory format. I know it&#x27;s a bit confusing.
Anyway the first step will be to extract the first 8 bits then apply a
division by 8. Which is equivalent to removing the 3 bits of the right.
The second step will be to extract the remaining 8 bits then apply a
multiplication by 32. It&#x27;s equivalent to shifting the data to the left 5
times. The last step is a blending addition between the 2 shifted depth
colors and we are done. We managed to extract only the interesting bits
of the depth. The new texture could be used to modulate any effects
based on depth information.</p><p>Here&#x27;s the float depth buffer of the GPU:</p><p><img loading="lazy" src="data:image/webp;base64,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" width="353" height="251" class="img_ev3q"></p><p>And now, the greenish texture generated to modulate the depth effect</p><p><img loading="lazy" src="data:image/webp;base64,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" width="353" height="247" class="img_ev3q"></p><h1>VI) Conclusion</h1><p>It is time to conclude this blog about the channel effect. There were
two possible ways to implement the effect on GSdx. The traditional
approach would be to emulate all those draw calls, manage all texture
conversions and so on. In short, emulate the GS that emulates a GPU OoO.
Unfortunately, even the best PCs would struggle.</p><p>So I implemented the alternate solution, replaced all the mess with a
couple of HLE shaders. It&#x27;s very efficient, thousands of draw calls were
replaced by 1 or 2 draw calls. Unfortunately, it isn&#x27;t perfect either.
There are two limitations, it requires to have some HLE shaders by game.
Currently not all games are supported (Ghost in the Shell, Manhunt 2,
Ridge Racer). And the core (EE/VU) will still generate a ton of
primitives to do the effect, albeit GSdx will happily throw everything
in the trash, nevertheless it is heavy on the core emulation.</p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog/tags/devblog">devblog</a></li></ul></div><div class="col margin-top--sm"><a href="https://github.com/PCSX2/pcsx2-net-www/tree/master/blog/2016/channel-shuffle-effect/index.mdx" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/blog/2016/q3-2016-progress-report"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Q3 2016 Progress Report</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/blog/2016/q2-2016-progress-report"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Q2 2016 Progress Report</div></a></nav></main></div></div></div><footer class="footer"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/downloads">Downloads</a></li><li class="footer__item"><a class="footer__link-item" href="/compat">Compatibility</a></li><li class="footer__item"><a class="footer__link-item" href="/docs">Documentation</a></li><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://forums.pcsx2.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Wiki<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://stats.uptimerobot.com/GAg8AuBByx" target="_blank" rel="noopener noreferrer" class="footer__link-item">Status<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Contribute</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/sponsors/PCSX2" target="_blank" rel="noopener noreferrer" class="footer__link-item">Donate<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/PCSX2/pcsx2" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.com/invite/TCz3t9k" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://forums.pcsx2.net/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Forums<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/PCSX2" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.youtube.com/user/PCSX2team" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">Legal</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/privacy">Privacy</a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 PCSX2. All Rights Reserved.</div></div></div></footer></div></div>
<script src="/assets/js/runtime~main.29d2e02b.js"></script>
<script src="/assets/js/main.ce2c7a2d.js"></script>
</body>
</html>